<html>
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
</head>
<body>

Search the folders to index and scan : <input type="text" id="folderValue" name="folderValue">
<button type="button" name="Search folder" onclick="submitSearch()" value="Search folder">Search Folder</button>
<br>
Submit all folders to scan
<button type="button" name="Scan folder" onclick="submitScan()" value="Scan folder">Scan Folder</button>


<div>
    <input class="search-input form-control">
</div>


<div id="jstree"></div>


<script>
    $(".search-input").keyup(function () {

        var searchString = $(this).val();
        //    console.log(searchString);
        $('#jstree').jstree('search', searchString);
    });

    function submitSearch() {
        $(function () {



            var folderValue = $("#folderValue").val();
            //  console.log(folderValue);

            $.ajax({
                dataType: "json",
                url: "browse?value=" + folderValue,
                type: 'GET',
                success: function (jsondata, codeHttp) {
                    console.log(codeHttp);
                    if (jsondata.error_message != null) {
                        alert(jsondata.error_message);
                    } else {
                        if (codeHttp == 'success') {

                            
                            $('#jstree').jstree({
                                'core': {
                                    'data': jsondata,
                                    'check_callback' : true
                                },
                                "checkbox": {
                                    "keep_selected_style": false
                                },
                                "search": {
                                    "case_insensitive": true,
                                    "show_only_matches": true
                                },
                                "plugins": ["checkbox", "search"]
                            });
//                            $("#jstree").jstree(true).settings.core.data = jsondata;
//                            $("#jstree").jstree(true).refresh();
//                            $("#jstree").jstree(true).redraw(true);
                        }
                    }
                }
            });
        });
    }

    function submitScan() {

        var checked = $('#jstree').jstree(true).get_selected();
        var a = [];
        for (i = 0; i < checked.length; i++) {
            var o = {};
            o = checked[i];
            a[i] = o;
        }
        var body = {};
        body.folders_toscan = a;
        var jsondata = JSON.stringify(body);
        console.log(jsondata);
        $.ajax({
            dataType: "json",
            url: "scan",
            type: 'POST',
            data: jsondata,
            success: function (responsedata, codeHttp) {
                if (codeHttp == "success") {
                    alert(responsedata);
                }
            }
        });
        console.log(checked);
    }
</script>

</body>
</html>