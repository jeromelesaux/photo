<html>
<head>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.css">
    <script src="https://cdn.jsdelivr.net/bootstrap.tagsinput/0.8.0/bootstrap-tagsinput.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/bootstrap.tagsinput/0.8.0/bootstrap-tagsinput.css">
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlTq4qvaXnme1o34Q2_Z3rJ6vuNin48FU"
            type="text/javascript">
    </script>
    <style type="text/css">

        #map img {
            border: none;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="content">

        <div id="loadingImage"
             style="display: none; position:fixed; z-index: 1104; background:url(ajax-loader.gif) no-repeat center center #D3D3D3; opacity: 0.3; width:100%;height: 100%">
        </div>
        <ul class="nav nav-tabs" data-tabs="tabs">
            <li class="active"><a href="#home" data-toggle="tab">Welcome</a></li>

            <li><a href="#search" data-toggle="tab">Search Photos</a></li>
            <li><a href="#albums" data-toggle="tab">Manage your albums</a></li>
            <li><a href="#scantab" data-toggle="tab">Scan directories on your local machines</a></li>
            <li><a href="#configuration" data-toggle="tab">Configure your cloud accounts</a></li>
            <li><a href="#history" data-toggle="tab">History actions</a></li>
        </ul>
        <div id="my-tab-content" class="tab-content">
            <!-- application configuration -->
            <div class="tab-pane active" id="home">
                <div class="panel panel-default">
                    <div class="panel-heading">News from app.</div>
                    <div class="panel-body">
                        <button data-toggle="collapse" data-target="#news" class="btn btn-primary">+ v1.0 Beta</button>
                        <div id="news" class="collapse">
                            <ul>
                                <li>now you can browse your local hard-drives and index all your photo on local or
                                    remote machines (need to run the
                                    agent on the remote machines).
                                </li>
                                <li>you can configure flickr and google photo account and import your albums and
                                    photosets.
                                </li>
                                <li>search with multi criteria such as : exif tags, filename, size and extension image
                                    files.
                                </li>
                                <li>generate a pdf album from all the set or a partial set of your albums.</li>
                                <li>filter on albums names.</li>
                                <li>get all history of your actions.</li>
                                <li>visualize photos localisations in Google Maps.</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>


            <div class="tab-pane" id="search">
                <form class="form-inline">
                    <div class="form-group">
                        <div class="panel panel-default">
                            <div class="panel-heading"><a data-toggle="collapse" href="#collapseSearchPanel">+ Search
                                Criteria</a></div>
                            <div id="collapseSearchPanel" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <table class="table">
                                        <tbody>
                                        <tr>
                                            <td>Enter extension image file to search :</td>
                                            <td>
                                                <select
                                                        class="form-control"
                                                        id="extensionList"> </select>
                                            </td>
                                            <td>
                                                <select class="form-control" id="fileSize">
                                                    <option value="big">big size</option>
                                                    <option value="medium">meduim size</option>
                                                    <option value="little">little size</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Enter exif tag of the image file to search :</td>
                                            <td>
                                                <input
                                                        type="text" id="exifTagValue"
                                                        name="exifTagValue"
                                                        class="form-control">
                                            </td>
                                        </tr>

                                        <tr>
                                            <td>Enter exif value of the image file to search :</td>
                                            <td>
                                                <input
                                                        type="text" id="exifValue"
                                                        name="exifValue"
                                                        class="form-control">
                                            </td>
                                        </tr>

                                        <tr>
                                            <td>Enter part of the filename of the image file to search
                                                :
                                            </td>
                                            <td>
                                                <input type="text" id="filename"
                                                       name="filename"
                                                       class="form-control">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Enter a tag to search
                                                :
                                            </td>
                                            <td><input type="text" id="tag"
                                                       name="tag"
                                                       class="form-control">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <button type="button" name="Find images" onclick="submitImagesSearch()"
                                                        value="Find images"
                                                        class="btn btn-primary start">
                                                    <span>Search Images</span>
                                                </button>
                                            </td>
                                            <td>
                                                <button type="button" name="clean " onclick="clean()" value="clean"
                                                        class="btn btn-primary start">
                                                    <span>clean</span>
                                                </button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading"><a data-toggle="collapse" href="#collapseMapPanel">+ Search on a
                                map</a></div>
                            <div id="collapseMapPanel" class="panel-collapse collapse">
                                <div class="panel-body" style="width: 750px">
                                    <button type="button" name="clean " onclick="loadMapData()"
                                            value="Get your photos location"
                                            class="btn btn-primary start">
                                        <span>Get your photos location</span>
                                    </button>
                                    <div id="map" style="width: 700px; height: 400px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading"><a data-toggle="collapse" href="#collapseTimeLinePanel">+ Search on
                                a time line</a></div>
                            <div id="collapseTimeLinePanel" class="panel-collapse collapse">
                                <div class="panel-body" style="width: 750px">
                                    Group your timeline photos by :
                                    <select class="form-control" id="timeGroupBy">
                                        <option value="month">by month</option>
                                        <option value="year">by year</option>
                                    </select>
                                    <button type="button" name="loadDataTimeLine" onclick="loadTimelineData()"
                                            value="Get your photos timeline"
                                            class="btn btn-primary start">
                                        <span>Get your photos timeline</span>
                                    </button>
                                    <div style="display:inline-block;width:100%;overflow-y:auto;">
                                        <ul class="timeline timeline-horizontal" id="timeline">

                                        </ul>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading"><a data-toggle="collapse" href="#collapsePhotosActionPanel">+ Actions
                                on photos</a></div>
                            <div id="collapsePhotosActionPanel" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <button type="button" name="clean " onclick="cleanDatabase()" value="clean database"
                                            class="btn btn-primary start">
                                        <span>clean database</span>
                                    </button>
                                    <button type="button" class="btn btn-info start" data-toggle="modal"
                                            data-target="#createNewAlbum">Create new
                                        album
                                    </button>
                                    <button type="button" class="btn btn-info start" data-toggle="modal"
                                            data-target="#updateExistingAlbum">Update
                                        an
                                        existing album
                                    </button>
                                    <button type="button" name="Download Selection"
                                            onclick="downloadSelectionFromSearch()"
                                            value="Download selection"
                                            class="btn btn-info start">
                                        <span>Download photo selection</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
                <div class="panel panel-default">
                    <div class="panel-heading">Images found.</div>
                    <div class="panel-body">
                        <!-- number of images returned by server -->
                        <div id="imagesFoundNumber"></div>
                        <!-- gallery of images found and returned by server -->
                        <div class="row">
                            <div id="imagesFound">
                            </div>
                        </div>
                    </div>
                </div>


                <!-- modal page to create new album -->
                <div id="createNewAlbum" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Create new album</h4>
                            </div>
                            <div class="modal-body">
                                <div class="offset8">Enter the new album new of your photo's selection :<input
                                        type="text" id="albumname"
                                        name="albumname"
                                        class="form-control"></div>

                                <div class="offset8">Enter the album description :<input type="text"
                                                                                         id="albumDescription"
                                                                                         name="albumDescription"
                                                                                         class="form-control"></div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal"
                                        onclick="createalbum()">Create Album
                                </button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- modal page to update an album -->
                <div id="updateExistingAlbum" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Update an existing album</h4>
                            </div>
                            <div class="modal-body">
                                <label for="updateAlbumList">Select an existing Album:</label>
                                <select class="form-control" id="updateAlbumList">
                                </select>
                                <div class="offset8">Album Name :<input type="text" id="updateAlbumName"
                                                                        name="updateAlbumName"
                                                                        class="form-control"></div>
                                <div class="offset8">Album description :<input type="text" id="updateAlbumDescription"
                                                                               name="updateAlbumDescription"
                                                                               class="form-control"></div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal"
                                        onclick="mergeAlbum()">Update Album
                                </button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- tab to display albums -->
            <div class="tab-pane" id="albums">
                <div class="form-group">
                    <button type="button" name="Retrieve the albums list" onclick="listAlbums()"
                            value="Retrieve the albums list"
                            class="btn btn-primary start">
                        <span>Retrieve the albums list</span>
                    </button>

                    <span class="glyphicon glyphicon-search"></span>
                    <input class="input-control" type="text" id="keySearch" onkeyup="searchKeyword()"
                           placeholder="Search for albums..">
                    <button type="button" class="btn btn-default" onclick="cleanKeyword()">X</button>
                    <!--<button type="button" class="btn btn-primary start" onclick="selectGoogleAlbums()">Google Albums</button>-->
                    <!--<button type="button" class="btn btn-primary start" onclick="selectFlickrAlbums()">Flickr Albums</button>-->
                </div>
                <div class="panel panel-default" style="width: 600px;">
                    <div class="panel-heading">Albums</div>
                    <div class="panel-body">

                        <select id="albumListId" class="form-control">
                        </select>
                    </div>
                </div>
                <br>

                <div class="panel panel-default" style="width: 600px;">
                    <div class="panel-heading"><a data-toggle="collapse" href="#collapseAlbumsPhotosActionsPanel">+ Albums photos actions</a></div>
                    <div id="collapseAlbumsPhotosActionsPanel" class="panel-collapse collapse">
                        <div class="panel-body">

                            <button type="button" name="Update the album" onclick="updateAlbumView()"
                                    value="Update the album informations"
                                    class="btn btn-info start">
                                <span>update the album</span>
                            </button>
                            <button type="button" name="Delete the album" onclick="deleteAlbum()"
                                    value="Delete the album"
                                    class="btn btn-info start">
                                <span>delete the album</span>
                            </button>
                            <button type="button" name="Delete the selected photos of the album"
                                    onclick="deletePhotosAlbum()"
                                    value="Delete selected photos from the album"
                                    class="btn btn-info start">
                                <span>delete selected photos from the album</span>
                            </button>
                            <button type="button" name="Clear photos selection"
                                    id="uncheckAlbumsSelection"
                                    value="Clear photos selection"
                                    class="btn btn-info start">
                                <span>clear photos selection</span>
                            </button>
                            <button type="button" name="Download pdf album" data-toggle="modal"
                                    data-target="#pdfExportSelectionDialog"
                                    value="Download pdf album"
                                    class="btn btn-info start">
                                <span>Download pdf album</span>
                            </button>
                            <button type="button" name="Download content album" onclick="downloadSelectionFromAlbum()"
                                    value="Download Content album"
                                    class="btn btn-info start">
                                <span>Download Content album</span>
                            </button>
                            <br>
                            Album's name <input type="text" id="albumNameId"
                                                name="albumNameId"
                                                class="form-control">

                            Description <input type="text" id="albumDescriptionId"
                                               name="albumDescriptionId"
                                               class="form-control">

                            <br>
                            <input type="text" id="albumTagsId"
                                   data-role="tagsinput"
                                   value="">
                        </div>

                    </div>

                    <!-- gallery of the album found and returned by server -->
                    <div class="row">

                        <div id="albumImagesFound"></div>
                    </div>


                    <div class="panel panel-default">

                        <!-- modal page to set flickr account settings -->
                        <div id="pdfExportSelectionDialog" class="modal fade" role="dialog">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title">Choose the photos number per page</h4>
                                    </div>
                                    <div class="modal-body">
                                        <select class="form-control" id="photoNumberPerPageInPdf">
                                            <option value="3">3 photos per page</option>
                                            <option value="4">4 photos per page</option>
                                        </select>
                                        <button type="button" name="select and download" onclick="getPdfAlbum()"
                                                data-dismiss="modal"
                                                value="Download pdf album"
                                                class="btn btn-info start">
                                            <span>select and download</span>
                                        </button>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="scantab">
                <div class="form-group">
                    <label for="activeMachineList">Select one machine:</label>
                    <select class="form-control" id="activeMachineList">
                    </select>
                </div>
                <form class="form-inline">
                    <div class="form-group">
                        Search the folders to index and scan : <input type="text" id="folderValue" name="folderValue"
                                                                      class="form-control">
                        <button type="button" name="Search folder" onclick="submitSearch()" value="Search folder"
                                class="btn btn-primary start">
                            <span>Search Folder</span>
                        </button>
                    </div>
                    <br>
                    Submit all folders to scan
                    <button type="button" name="Scan folder" onclick="submitScan()" value="Scan folder"
                            class="btn btn-primary start">
                        <span>Scan Folder</span>
                    </button>
                </form>
                <div>
                    <input class="search-input form-control">
                </div>
                <div id="jstree"></div>
            </div>
            <div class="tab-pane" id="configuration">
                Registered machines :
                <ul id="machineList" class="list-group"></ul>
                <button type="button" name="refresh" onclick="refresh()" value="refresh" class="btn btn-primary start">
                    <span>refresh</span>
                </button>
                <div class="panel panel-default">
                    <div class="panel-heading">Google Account settings</div>
                    <div class="panel-body">
                        <!-- gallery of images found and returned by server -->
                        <div class="row">
                            <form id="googleConfigurationForm">
                                Google User ID <input type="text" id="googleUserId" class="form-control">
                                Google ID<input type="text" id="googleId" class="form-control">
                                Google Secret Phrase<input type="password" id="googleSecret" class="form-control">
                            </form>
                            <button type="button" name="save google account" onclick="saveAndImportGoogleAccount()"
                                    value="save and import google account"
                                    class="btn btn-primary start">
                                <span>Save and import google account</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Flickr Account settings</div>
                    <div class="panel-body">
                        <!-- gallery of images found and returned by server -->
                        <div class="row">
                            <form id="flickrConfigurationForm">
                                Flickr API Key <input type="text" id="flickrApiKey" class="form-control">
                                Flickr API Secret<input type="password" id="flickrApiSecret" class="form-control">
                                Flickr Oauth verifier Token :<input type="text" id="flickrToken"
                                                                    name="flickrToken"
                                                                    class="form-control">
                            </form>
                            <button type="button" class="btn btn-primary start" data-toggle="modal"
                                    data-target="#flickrOauthVerifer">
                                <span>Get flickr token to import albums</span>
                            </button>
                            <button type="button" class="btn btn-primary start" data-dismiss="modal"
                                    onclick="goImportFlickrAlbum()">
                                <span>import flickr albums</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- modal page to set flickr account settings -->
                <div id="flickrOauthVerifer" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Flickr Oauth verifier token</h4>
                            </div>
                            <div class="modal-body">
                                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="goFlickr()">
                                    Get the flickr token
                                </button>
                            </div>
                            <div class="modal-footer">

                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="tab-pane" id="history">
                <div class="panel panel-default">
                    <div class="panel-heading">application actions history
                        <button id="refreshTable" class="btn btn-default" onclick="refreshTable()">Refresh data</button>
                    </div>
                    <div class="panel-body">
                        <table data-toggle="table" class="display" data-url="./history" id="tableActionsMessages"
                               data-sort-name="date" data-sort-order="desc">
                            <tr>
                                <td>actions messages</td>
                            </tr>
                            <thead>
                            <tr>
                                <th data-field="date" data-sortable="true">date</th>
                                <th data-field="message" data-sortable="false">message</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            <style type="text/css">

                /* Timeline css  */
                /* Timeline */
                .timeline,
                .timeline-horizontal {
                    list-style: none;
                    padding: 20px;
                    position: relative;
                }

                .timeline:before {
                    top: 40px;
                    bottom: 0;
                    position: absolute;
                    content: " ";
                    width: 3px;
                    background-color: #eeeeee;
                    left: 50%;
                    margin-left: -1.5px;
                }

                .timeline .timeline-item {
                    margin-bottom: 20px;
                    position: relative;
                }

                .timeline .timeline-item:before,
                .timeline .timeline-item:after {
                    content: "";
                    display: table;
                }

                .timeline .timeline-item:after {
                    clear: both;
                }

                .timeline .timeline-item .timeline-badge {
                    color: #fff;
                    width: 54px;
                    height: 54px;
                    line-height: 52px;
                    font-size: 22px;
                    text-align: center;
                    position: absolute;
                    top: 18px;
                    left: 50%;
                    margin-left: -25px;
                    background-color: #7c7c7c;
                    border: 3px solid #ffffff;
                    z-index: 100;
                    border-top-right-radius: 50%;
                    border-top-left-radius: 50%;
                    border-bottom-right-radius: 50%;
                    border-bottom-left-radius: 50%;
                }

                .timeline .timeline-item .timeline-badge i,
                .timeline .timeline-item .timeline-badge .fa,
                .timeline .timeline-item .timeline-badge .glyphicon {
                    top: 2px;
                    left: 0px;
                }

                .timeline .timeline-item .timeline-badge.primary {
                    background-color: #1f9eba;
                }

                .timeline .timeline-item .timeline-badge.info {
                    background-color: #5bc0de;
                }

                .timeline .timeline-item .timeline-badge.success {
                    background-color: #59ba1f;
                }

                .timeline .timeline-item .timeline-badge.warning {
                    background-color: #d1bd10;
                }

                .timeline .timeline-item .timeline-badge.danger {
                    background-color: #ba1f1f;
                }

                .timeline .timeline-item .timeline-panel {
                    position: relative;
                    width: 46%;
                    float: left;
                    right: 16px;
                    border: 1px solid #c0c0c0;
                    background: #ffffff;
                    border-radius: 2px;
                    padding: 20px;
                    -webkit-box-shadow: 0 1px 6px rgba(0, 0, 0, 0.175);
                    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.175);
                }

                .timeline .timeline-item .timeline-panel:before {
                    position: absolute;
                    top: 26px;
                    right: -16px;
                    display: inline-block;
                    border-top: 16px solid transparent;
                    border-left: 16px solid #c0c0c0;
                    border-right: 0 solid #c0c0c0;
                    border-bottom: 16px solid transparent;
                    content: " ";
                }

                .timeline .timeline-item .timeline-panel .timeline-title {
                    margin-top: 0;
                    color: inherit;
                }

                .timeline .timeline-item .timeline-panel .timeline-body > p,
                .timeline .timeline-item .timeline-panel .timeline-body > ul {
                    margin-bottom: 0;
                }

                .timeline .timeline-item .timeline-panel .timeline-body > p + p {
                    margin-top: 5px;
                }

                .timeline .timeline-item:last-child:nth-child(even) {
                    float: right;
                }

                .timeline .timeline-item:nth-child(even) .timeline-panel {
                    float: right;
                    left: 16px;
                }

                .timeline .timeline-item:nth-child(even) .timeline-panel:before {
                    border-left-width: 0;
                    border-right-width: 14px;
                    left: -14px;
                    right: auto;
                }

                .timeline-horizontal {
                    list-style: none;
                    position: relative;
                    padding: 20px 0px 20px 0px;
                    display: inline-block;
                }

                .timeline-horizontal:before {
                    height: 3px;
                    top: auto;
                    bottom: 26px;
                    left: 56px;
                    right: 0;
                    width: 100%;
                    margin-bottom: 20px;
                }

                .timeline-horizontal .timeline-item {
                    display: table-cell;
                    height: 280px;
                    width: 20%;
                    min-width: 320px;
                    float: none !important;
                    padding-left: 0px;
                    padding-right: 20px;
                    margin: 0 auto;
                    vertical-align: bottom;
                }

                .timeline-horizontal .timeline-item .timeline-panel {
                    top: auto;
                    bottom: 64px;
                    display: inline-block;
                    float: none !important;
                    left: 0 !important;
                    right: 0 !important;
                    width: 100%;
                    margin-bottom: 20px;
                }

                .timeline-horizontal .timeline-item .timeline-panel:before {
                    top: auto;
                    bottom: -16px;
                    left: 28px !important;
                    right: auto;
                    border-right: 16px solid transparent !important;
                    border-top: 16px solid #c0c0c0 !important;
                    border-bottom: 0 solid #c0c0c0 !important;
                    border-left: 16px solid transparent !important;
                }

                .timeline-horizontal .timeline-item:before,
                .timeline-horizontal .timeline-item:after {
                    display: none;
                }

                .timeline-horizontal .timeline-item .timeline-badge {
                    top: auto;
                    bottom: 0px;
                    left: 43px;
                }
            </style>
            <script>
                var map;
                jQuery(window).resize(function () {
                    if (map == undefined) {
                        initMap();
                    }
                });
                jQuery('#search').on('click', function () {
                    if (map == undefined) {
                        initMap();
                    }
                });

                $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                    if (map != undefined) {
                        center = map.getCenter();
                        google.maps.event.trigger(map, 'resize');         // fixes map display
                        map.setCenter(center);
                    }
                });

                $(document).ready(function () {
                    getRegisteredMachines();
                    getExtensionList();
                    loadGoogleAccount();
                    loadFlickrAccount();
                    $("#uncheckAlbumsSelection").click(function () {
                        $(this).find('input.album[type=checkbox]').prop("checked", false);
                    })
                });


                $(function () {
                    $(document).ajaxStart(function () {
                        $('#loadingImage').show();
                    });

                    $(document).ajaxStop(function () {
                        $('#loadingImage').hide();
                    });
                });

                function getPhotosFromTime(groupby, date) {
                    $.ajax({
                        dataType: "json",
                        url: "photosfromtime?groupby=" + groupby + "&date=" + date,
                        type: 'GET',
                        success: function (jsondata, codeHttp) {
                            $('#imagesFound').empty();
                            if (jQuery.isEmptyObject(jsondata)) {
                                alert("No images found.");
                            } else {
                                $('#imagesFoundNumber').html("Found " + jsondata.length + " images.");
                                feedElementbyItems(jsondata, 'imagesFound', 'search', false);
                            }
                        }
                    })
                }

                function loadTimelineData() {
                    var groupby = $('#timeGroupBy').val();
                    $('#timeline').empty();
                    $.ajax({
                        dataType: "json",
                        url: "timesstats?groupby=" + groupby,
                        type: 'GET',
                        success: function (jsondata, codeHttp) {
                            jsondata.stats.sort(function (a, b) {
                                return Date.parse(a.date) - Date.parse(b.date);
                            });
                            $.each(jsondata.stats, function (i, item) {
                                console.log(item.date + ":" + item.count);
                                $('#timeline').append('<li class="timeline-item">' +
                                    '<div class="timeline-badge primary"><i class="glyphicon glyphicon-check"></i></div>' +
                                    '<div class="timeline-panel">' +
                                    '<div class="timeline-heading">' +
                                    '<h4 class="timeline-title">Number of pictures ' + item.count + '</h4>' +
                                    '<p><small class="text-muted"><i class="glyphicon glyphicon-time"></i>' + item.date + '</small></p>' +
                                    '</div>' +
                                    '<div class="timeline-body">' +
                                    '<p><button type="button" name="getPhotosGroupBy" onclick="getPhotosFromTime(\'' + groupby + '\',\'' + item.date + '\')" value="Get your photos timeline" class="btn btn-primary start">' +
                                    '<span>Get your photos for this date</span> </button></p>' +
                                    '</div></div></li>');
                            })
                        }
                    })
                }

                function getPhotosFromCoordinates(lat, lng) {
                    console.log("latitude : " + lat + " and longitude " + lng);
                    $.ajax({
                        dataType: "json",
                        url: "photosfromlocation?lat=" + lat + "&lng=" + lng,
                        type: 'GET',
                        success: function (jsondata, codeHttp) {
                            $('#imagesFound').empty();
                            if (jQuery.isEmptyObject(jsondata)) {
                                alert("No images found.");
                            } else {
                                $('#imagesFoundNumber').html("Found " + jsondata.length + " images.");
                                feedElementbyItems(jsondata, 'imagesFound', 'search', false);
                            }
                        }
                    })
                }

                $('#albumListId').on('change', function () {
                    var albumName = $(this).find("option:selected").val();
                    getAlbum(albumName);
                });

                function initMap() {
                    $(function () {
                        document.getElementById('map').style.display = "block";
                        var location = new google.maps.LatLng(48.2, 2.2);
                        map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 2,
                            center: location,
                            mapTypeId: google.maps.MapTypeId.ROADMAP
                        });
                        setTimeout(function () {
                            $('.search').append($("#map").css("margin-top", "0px").get(0));
                        }, 500);
                        center = map.getCenter();
                        google.maps.event.trigger(map, 'resize');         // fixes map display
                        map.setCenter(center);
                    })

                }

                function loadMapData() {
                    $.ajax({
                        dataType: "json",
                        url: "locationsstats",
                        type: 'GET',
                        success: function (responsedata, codeHttp) {
                            if (codeHttp === "success") {
                                $.each(responsedata.stat, function (i, item) {
                                    var coord = {lat: item.latitude, lng: item.longitude};
                                    var marker = new google.maps.Marker({
                                        position: coord,
                                        icon: "http://maps.google.com/mapfiles/kml/pal4/icon46.png",
                                        map: map,
                                        title: "Number of pictures : " + item.count
                                    });
                                    marker.addListener('click', function (event) {
                                        getPhotosFromCoordinates(item.latitude, item.longitude);
                                    });
                                    map.setCenter(marker.getPosition());
                                    map.setZoom(3);
                                });
                            }
                        }
                    });
                }


                // script javascript to manage selection of the photo
                $("body").on("click", 'label',
                    function (event) {
                        var input = $(this).find(":checkbox");
                        if (input.is(":checked") === false) {
                            input.prop('checked', true);
                            console.log("checked");
                            $(this).animate({'opacity': '0.5'}, 350);
                        } else {
                            input.prop('checked', false);
                            console.log("unchecked");
                            $(this).animate({'opacity': '1'}, 150);
                        }
                        event.preventDefault();
                    });

                function refreshTable() {
                    var table = $('#tableActionsMessages');
                    table.bootstrapTable('refresh');
                }

                function cleanKeyword() {
                    $('#keySearch').val("");
                    searchKeyword();
                }

                function searchKeyword() {
                    var input, filter, albums;
                    input = document.getElementById("keySearch");
                    filter = input.value.toUpperCase();
                    albums = document.getElementById("albumListId").childNodes;
                    for (var i = 0; i < albums.length; i++) {
                        var label = albums[i].innerText.toUpperCase();
                        if (label.indexOf(filter) === -1) {
                            albums[i].style.display = "none";
                        } else {
                            albums[i].style.display = "block";
                        }
                    }

                }


                function loadFlickrAccount() {
                    $(function () {
                        $.ajax({
                            dataType: "json",
                            url: "flickrload",
                            type: 'GET',
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    $('#flickrApiKey').val(responsedata.api_key);
                                    $('#flickrApiSecret').val(responsedata.api_secret);
                                    $('#flickrToken').val(responsedata.flickr_token);
                                }
                            }
                        });
                    })
                }

                function goImportFlickrAlbum() {
                    $(function () {
                        var flickrKey = $('#flickrApiKey').val();
                        var flickrSecret = $('#flickrApiSecret').val();
                        var flickrToken = $('#flickrToken').val();
                        var body = {};
                        body.api_key = flickrKey;
                        body.api_secret = flickrSecret;
                        body.flickr_token = flickrToken;
                        var jsondata = JSON.stringify(body);
                        $.ajax({
                            dataType: "json",
                            url: "flickrloadalbums",
                            type: 'POST',
                            data: jsondata,
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    alert(responsedata);
                                }
                            }
                        });
                    })
                }

                function goFlickr() {
                    $(function () {
                        var flickrKey = $('#flickrApiKey').val();
                        var flickrSecret = $('#flickrApiSecret').val();
                        var body = {};
                        body.api_key = flickrKey;
                        body.api_secret = flickrSecret;
                        var jsondata = JSON.stringify(body);
                        $.ajax({
                            dataType: "json",
                            url: "flickrsave",
                            type: 'POST',
                            data: jsondata,
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    var msg = "Go and set the flickr token after authorization " + responsedata.url_authorization;
                                    alert(msg);
                                }
                            }
                        });
                    })
                }

                function saveAndImportGoogleAccount() {
                    $(function () {
                        var googleUserId = $('#googleUserId').val();
                        var googleId = $('#googleId').val();
                        var googleSecret = $('#googleSecret').val();
                        var body = {};
                        body.id = googleId;
                        body.secret = googleSecret;
                        body.user_id = googleUserId;
                        var jsondata = JSON.stringify(body);
                        console.log(jsondata);
                        $.ajax({
                            dataType: "json",
                            url: "googlesave",
                            type: 'POST',
                            data: jsondata,
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    alert(responsedata);
                                }
                            }
                        });
                    })
                }

                function loadGoogleAccount() {
                    $(function () {
                        $.ajax({
                            dataType: "json",
                            url: "googleload",
                            type: 'GET',
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    $('#googleUserId').val(responsedata.user_id);
                                    $('#googleId').val(responsedata.id);
                                    $('#googleSecret').val(responsedata.secret);
                                }
                            }
                        });
                    })
                }

                function getPdfAlbum() {
                    $(function () {
                        var values = [];
                        var valuesUrl = "";
                        var partial = false;
                        var numberPhotosPerPageSelection = $('#photoNumberPerPageInPdf').val();
                        console.log(numberPhotosPerPageSelection);
                        $('input.album[type=checkbox]').each(function () {
                            if ($(this).is(":checked") === true) {
                                values.push($(this).val());
                            }
                        });
                        var albumName = $('#albumNameId').val();
                        if (values.length > 0) {
                            if (confirm("You have selected " + values.length + " photos for the pdf. Do you want to create a pdf with only this selection ?") === true) {
                                for (var i = 0; i < values.length; i++) {
                                    valuesUrl += values[i];
                                    if ((i + 1) < values.length) {
                                        valuesUrl += ",";
                                    }
                                }
                                valuesUrl += "";
                                partial = true;
                                //console.log(valuesUrl);
                            } else {
                                return;
                            }
                        }

                        var url = "pdfalbum?albumName=" + albumName + "&numberPhotosPerPage=" + numberPhotosPerPageSelection;
                        if (partial) {
                            url += "&photosid=" + valuesUrl;
                        }
                        console.log(url);
                        // Get file name from url.
                        var filename = albumName + ".pdf";
                        var xhr = new XMLHttpRequest();
                        xhr.responseType = 'blob';
                        xhr.onload = function () {
                            var a = document.createElement('a');
                            a.href = window.URL.createObjectURL(xhr.response); // xhr.response is a blob
                            a.download = filename; // Set the file name.
                            a.style.display = 'none';
                            document.body.appendChild(a);
                            a.click();
                            delete a;
                        };
                        xhr.open('GET', url);
                        xhr.send();

                    })
                }

                function clearSelectionAlbum() {
                    $(function () {
                        $(this).find('input.album[type=checkbox]').prop("checked", false);
//                        $('input.album[type=checkbox]').attr('checked',false);
//                        $('input.album[type=checkbox]').each(function () {
//                            var input = $(this);
//                            if (input.is(":checked") == true) {
//                                input.type(":checkbox:enabled").attr("checked",false);
//                            }
//                        });
                    })
                }

                function deletePhotosAlbum() {
                    $(function () {
                        var values = [];
                        var albumName = $('#albumNameId').val();
                        var albumDescription = $('#albumDescriptionId').val();
                        $('input.album[type=checkbox]').each(function () {
                            if ($(this).is(":checked") === true) {
                                values.push($(this).val());
                            }
                        });
                        var body = {};
                        console.log(values);
                        body.album_name = albumName;
                        body.description = albumDescription;
                        body.md5sums = values;
                        var jsondata = JSON.stringify(body);
                        console.log(jsondata);
                        $.ajax({
                            dataType: "json",
                            url: "deletephotosalbum",
                            type: 'DELETE',
                            data: jsondata,
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    alert(responsedata);
                                }
                            }
                        });
                    });
                }

                function mergeAlbum() {
                    $(function () {
                        var values = [];
                        var albumName = $('#updateAlbumName').val();
                        var albumDescription = $('#updateAlbumDescription').val();
                        $('input.search[type=checkbox]').each(function () {
                            if ($(this).is(":checked") === true) {
                                values.push($(this).val());
                            }
                        });
                        // console.log(values);
                        var body = {};
                        body.album_name = albumName;
                        body.description = albumDescription;
                        body.md5sums = values;
                        var jsondata = JSON.stringify(body);
                        // console.log(jsondata);
                        $.ajax({
                            dataType: "json",
                            url: "updatealbum",
                            type: 'POST',
                            data: jsondata,
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    alert(responsedata);
                                }
                            }
                        });
                    });
                }

                $("#updateExistingAlbum").on("show.bs.modal", function (e) {
                    updateAlbumList()
                });

                $("#updateAlbumList").on("change", function () {
                    var selectedAlbum = $(this).find("option:selected").val();
                    $.ajax({
                        dataType: "json",
                        url: "/getalbum?albumName=" + selectedAlbum,
                        type: 'GET',
                        success: function (jsondata, codeHttp) {
                            // console.log(jsondata);
                            $('#updateAlbumName').val(jsondata.album_name);
                            $('#updateAlbumDescription').val(jsondata.description);
                        }
                    });
                });

                function downloadSelection(fileOutput, values) {
                    $(function () {
                        url = "/download?md5sums=";
                        for (i = 0; i < (values.length - 1); i++) {
                            url += values[i] + ","
                        }
                        url += values[i]
                        console.log(url);
                        var xhr = new XMLHttpRequest();
                        xhr.responseType = 'blob';
                        xhr.onload = function () {
                            var a = document.createElement('a');
                            a.href = window.URL.createObjectURL(xhr.response); // xhr.response is a blob
                            a.download = fileOutput; // Set the file name.
                            a.style.display = 'none';
                            document.body.appendChild(a);
                            a.click();
                            delete a;
                        };
                        xhr.open('GET', url);
                        xhr.send();

                    })
                }

                function downloadSelectionFromSearch() {
                    var values = [];
                    $('input.search[type=checkbox]').each(function () {
                        if ($(this).is(":checked") === true) {
                            values.push($(this).val());
                        }
                    });
                    if (values.length == 0) {
                        $('input.search[type=checkbox]').each(function () {
                            values.push($(this).val());
                        });
                    }
                    downloadSelection("content.zip", values);
                }

                function downloadSelectionFromAlbum() {
                    var values = [];
                    $('input.album[type=checkbox]').each(function () {
                        if ($(this).is(":checked") === true) {
                            values.push($(this).val());
                        }
                    });
                    if (values.length == 0) {
                        $('input.album[type=checkbox]').each(function () {
                            values.push($(this).val());
                        });
                    }
                    downloadSelection("album-content.zip", values);
                }

                function updateAlbumList() {
                    $(function () {
                        $.ajax({
                            dataType: "json",
                            url: "/albums",
                            type: 'GET',
                            success: function (jsondata, codeHttp) {
                                //   console.log(jsondata);
                                $('#updateAlbumList').empty();
                                if (jQuery.isEmptyObject(jsondata)) {
                                    alert("No albums set.");
                                } else {
                                    $.each(jsondata, function (i, item) {
                                        $('#updateAlbumList').append('<option value="' + item + '">' + item + '</option>');
                                    });
                                }
                            }
                        })
                    })
                }

                function deleteAlbum() {
                    $(function () {
                        var albumName = $('#albumNameId').val();
                        var body = {};
                        body.album_name = albumName;
                        var jsondata = JSON.stringify(body);
                        //  console.log(jsondata);
                        $.ajax({
                            dataType: "json",
                            url: "deletealbum",
                            type: 'DELETE',
                            data: jsondata,
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    alert(responsedata);
                                }
                            }
                        });
                    })
                }

                function updateAlbumView() {
                    $(function () {
                        var albumName = $('#albumNameId').val();
                        var albumDescription = $('#albumDescriptionId').val();
                        var tags = $('#albumTagsId').tagsinput('items');
                        var body = {};
                        body.album_name = albumName;
                        body.description = albumDescription;
                        body.tags = tags;
                        var jsondata = JSON.stringify(body);
                        //  console.log(jsondata);
                        $.ajax({
                            dataType: "json",
                            url: "updatealbum",
                            type: 'POST',
                            data: jsondata,
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    alert(responsedata);
                                }
                                else {
                                    alert("error while saving the album");
                                }
                            }
                        });
                    })
                }

                function feedElementbyItems(items, tagname, classlabel, useThumbnail) {

                    $(function () {
                        $.each(items, function (i, item) {
                            if (useThumbnail) {
                                $('#' + tagname).append(
                                    '<div class="col-xs-4">' +
                                    '<label class="btn btn-primary img-check">' +
                                    '<img class="img-rounded " src="data:image/png;base64,' + item.thumbnail + '" alt="' + item.filename + '"/>' +
                                    '<input type="checkbox" id="' + item.filename + '" value="' + item.md5sum + '" class="hidden ' + classlabel + '" autocomplete="off">' +
                                    '</label>' +
                                    '<button onclick="toggler(\'' + classlabel + item.md5sum + '\')"   class="btn">+</button>' +
                                    '<div id="#' + classlabel + item.md5sum + '" style="display: none;">' +
                                    '<br><a href="' + item.filepath + '" target="_blank">Get original</a>' +
                                    '<br>' + item.filename + '<br>' + displayExifTags(item.exiftags) +
                                    '</div>' +
                                    '</div>'
                                );
                            } else {
                                $('#' + tagname).append(
                                    '<div class="col-xs-4">' +
                                    '<label class="btn btn-primary img-check">' +
                                    '<img class="img-rounded " src="data:image/png;base64,' + item.image + '" alt="' + item.filename + '"/>' +
                                    '<input type="checkbox" id="' + item.filename + '" value="' + item.md5sum + '" class="hidden ' + classlabel + '" autocomplete="off">' +
                                    '</label>' +
                                    '<button onclick="toggler(\'' + classlabel + item.md5sum + '\')"   class="btn">+</button>' +
                                    '<div id="#' + classlabel + item.md5sum + '" style="display: none;">' +
                                    '<br><a href="' + item.filepath + '" target="_blank">Get original</a>' +
                                    '<br>' + item.filename + '<br>' + displayExifTags(item.exiftags) +
                                    '</div>' +
                                    '</div>'
                                );
                            }
                        })
                    })
                }

                function getAlbum(albumName) {
                    $(function () {
                        $('#albumImagesFound').empty();
                        $('#albumTagsId').tagsinput('removeAll');
                        $.ajax({
                            dataType: "json",
                            url: "/getalbum?albumName=" + albumName,
                            type: 'GET',
                            success: function (jsondata, codeHttp) {
                                $('#albumNameId').val(jsondata.album_name);
                                $('#albumDescriptionId').val(jsondata.description);
                                $('#albumTagsId').tagsinput('add', jsondata.tags.join(", "));
                                console.log(jsondata.tags.join(", "));
                                feedElementbyItems(jsondata.records, 'albumImagesFound', 'album', true);
                            }
                        });
                    });
                }

                function toggler(divId) {
                    var x = document.getElementById('#' + divId);
                    if (x.style.display === 'none') {
                        x.style.display = 'block';
                    } else {
                        x.style.display = 'none';
                    }
                }

                //                function selectGoogleAlbums() {
                //                    $(function(){
                //                        $.ajax({
                //                            dataType: "json",
                //                            url: "/albums?type=google",
                //                            type: 'GET',
                //                            success: function (jsondata, codeHttp) {
                //                                //  console.log(jsondata);
                //                                $('#albumListId').empty();
                //                                if (jQuery.isEmptyObject(jsondata)) {
                //                                    alert("No albums set.");
                //                                } else {
                //                                    $.each(jsondata, function (i, item) {
                //                                        $('#albumListId').append('<button type="button" name="' + item +
                //                                            '" onclick="getAlbum(\'' + item + '\')" value="' + item + ' " class="btn btn-primary start">' + item + '</button>');
                //                                    });
                //                                }
                //                            }
                //                        })
                //                    })
                //                }
                //
                //                function selectFlickrAlbums() {
                //                    $(function(){
                //                        $.ajax({
                //                            dataType: "json",
                //                            url: "/albums?type=flickr",
                //                            type: 'GET',
                //                            success: function (jsondata, codeHttp) {
                //                                //  console.log(jsondata);
                //                                $('#albumListId').empty();
                //                                if (jQuery.isEmptyObject(jsondata)) {
                //                                    alert("No albums set.");
                //                                } else {
                //                                    $.each(jsondata, function (i, item) {
                //                                        $('#albumListId').append('<button type="button" name="' + item +
                //                                            '" onclick="getAlbum(\'' + item + '\')" value="' + item + ' " class="btn btn-primary start">' + item + '</button>');
                //                                    });
                //                                }
                //                            }
                //                        })
                //                    })
                //                }

                function listAlbums() {
                    $(function () {
                        $.ajax({
                            dataType: "json",
                            url: "/albums",
                            type: 'GET',
                            success: function (jsondata, codeHttp) {
                                //  console.log(jsondata);
                                $('#albumListId').empty();
                                if (jQuery.isEmptyObject(jsondata)) {
                                    alert("No albums set.");
                                } else {
                                    jsondata.sort(function (a, b) {
                                        return a.localeCompare(b);
                                    });
                                    $.each(jsondata, function (i, item) {
                                        $('#albumListId').append('<option name="' + item +
                                            'value="' + item + ' " class="btn">' + item + '</option>');
                                    });
                                }
                            }
                        })
                    })
                }

                function createalbum() {
                    $(function () {
                        var values = [];
                        var albumName = $("#albumname").val();
                        $('input.search[type=checkbox]').each(function () {
                            if ($(this).is(":checked") === true) {
                                values.push($(this).val());
                            }
                        });
                        var body = {};
                        body.album_name = albumName;
                        body.md5sums = values;
                        body.description = $("#albumDescription").val();
                        var jsondata = JSON.stringify(body);
                        //  console.log(jsondata);
                        $.ajax({
                            dataType: "json",
                            url: "createalbum",
                            type: 'POST',
                            data: jsondata,
                            success: function (responsedata, codeHttp) {
                                if (codeHttp === "success") {
                                    alert(responsedata);
                                }
                            }
                        });

                    });
                }

                function cleanDatabase() {
                    $(function () {
                        $.ajax({
                            dataType: "json",
                            url: "/cleandatabase",
                            type: "POST",
                            success: function (jsondata, codeHttp) {
                                if (codeHttp === "success") {
                                    alert("Database cleaned.");
                                }
                            }
                        })
                    })
                }

                function clean() {
                    $(function () {
                        $('#exifTagValue').val('');
                        $('#exifValue').val('');
                        $('#filename').val('');
                        $('#tag').val('');
                    })
                }

                function getExtensionList() {
                    $(function () {
                        $.ajax({
                            dataType: "json",
                            url: "/getfileextension",
                            type: 'GET',
                            success: function (jsondata, codeHttp) {
                                $('#extensionList').empty();
                                $.each(jsondata.Extensions, function (i, item) {
                                    $('#extensionList').append('<option value="' + item + '">' + item + '</option>');
                                });
                            }
                        })
                    })
                }


                var ExtensionSelected = "";

                function displayExifTags(exiftags) {
                    var display = "";
                    $.each(exiftags, function (i, item) {
                        display += i + ":" + item + "<br>";
                    });
                    return display;
                }

                function submitImagesSearch() {
                    $(function () {
                        $('#imagesFoundNumber').empty();
                        var exifTag = $('#exifTagValue').val();
                        var exifValue = $('#exifValue').val();
                        var size = $('#fileSize').val();
                        var tag = $('#tag').val();
                        $('#extensionList').each(function () {
                            ExtensionSelected = $(this).val();
                        });
                        var filename = $('#filename').val();

                        if (tag != "") {
                              console.log("Calling /tag?value=" + tag);
                            $.ajax({
                                dataType: "json",
                                url: "/tag?value=" + tag,
                                type: 'GET',
                                success: function (jsondata, codeHttp) {
                                    console.log(jsondata);

                                    $('#imagesFound').empty();
                                    if (jQuery.isEmptyObject(jsondata)) {
                                        alert("No images found.");
                                    } else {
                                        $('#imagesFoundNumber').html("Found " + jsondata.length + " images.");
                                        feedElementbyItems(jsondata, 'imagesFound', 'search', true);
                                    }
                                }
                            })
                        } else {

                            if (filename !== "") {
                                console.log("Calling /queryfilename?value=" + filename + "&filesize=" + size);
                                $.ajax({
                                    dataType: "json",
                                    url: "/queryfilename?value=" + filename + "&filesize=" + size,
                                    type: 'GET',
                                    success: function (jsondata, codeHttp) {
                                        //  console.log(jsondata);

                                        $('#imagesFound').empty();
                                        if (jQuery.isEmptyObject(jsondata)) {
                                            alert("No images found.");
                                        } else {
                                            $('#imagesFoundNumber').html("Found " + jsondata.length + " images.");
                                            feedElementbyItems(jsondata, 'imagesFound', 'search', false);
                                        }
                                    }
                                })
                            } else {
                                if (exifTag === "" && exifValue === "" && ExtensionSelected !== "") {
                                    console.log("Calling /queryextension?value=" + ExtensionSelected + "&filesize=" + size);
                                    $.ajax({
                                        dataType: "json",
                                        url: "/queryextension?value=" + ExtensionSelected + "&filesize=" + size,
                                        type: 'GET',
                                        success: function (jsondata, codeHttp) {
                                            //  console.log(jsondata);

                                            $('#imagesFound').empty();
                                            if (jQuery.isEmptyObject(jsondata)) {
                                                alert("No images found.");
                                            } else {
                                                $('#imagesFoundNumber').html("Found " + jsondata.length + " images.");
                                                feedElementbyItems(jsondata, 'imagesFound', 'search', false);
                                            }
                                        }
                                    })
                                } else {
                                    console.log("Calling /queryexif?value=" + exifValue + "&exif=" + exifTag);
                                    $.ajax({
                                        dataType: "json",
                                        url: "/queryexif?value=" + exifValue + "&exif=" + exifTag + "&filesize=" + size,
                                        type: 'GET',
                                        success: function (jsondata, codeHttp) {
                                            $('#imagesFound').empty();
                                            if (jQuery.isEmptyObject(jsondata)) {
                                                alert("No images found.");
                                            } else {
                                                $('#imagesFoundNumber').html("Found " + jsondata.length + " images.");
                                                feedElementbyItems(jsondata, 'imagesFound', 'search', false);
                                            }
                                        }
                                    })
                                }
                            }
                        }
                    });
                }

                function refresh() {
                    $(function () {
                        getRegisteredMachines();
                        getExtensionList();
                    })
                }

                function getRegisteredMachines() {
                    $(function () {
                        $.ajax({
                            dataType: "json",
                            url: "/registeredslaves",
                            type: 'GET',
                            success: function (jsondata, codeHttp) {
                                var listContainer = $("#machineList");
                                listContainer.empty();
                                var selectPicker = $("#activeMachineList");
                                selectPicker.empty();
                                // event.preventDefault();
                                for (var i = 0; i < jsondata.length; i++) {
                                    console.log("adding " + jsondata[i].ipv4);
                                    listContainer.prepend('<li class="list-group-item">' + jsondata[i].ipv4 + '</li>');
                                    selectPicker.append('<option value="' + jsondata[i].machineId + '">' + jsondata[i].ipv4 + '</option>');
                                }
                            }
                        });
                    })
                }


                $(".search-input").keyup(function () {
                    var searchString = $(this).val();
                    //    console.log(searchString);
                    $('#jstree').jstree('search', searchString);
                });

                var MachineID = "";


                function submitSearch() {
                    $(function () {
                        var folderValue = $("#folderValue").val();
                        $('#activeMachineList').each(function () {
                            MachineID = $(this).val();
                        });
                        if (MachineID === "") {
                            alert("Please select a machine before");
                        } else {
                            console.log(MachineID);
                            $.ajax({
                                dataType: "json",
                                url: "browse?value=" + folderValue + "&machineId=" + MachineID,
                                type: 'GET',
                                success: function (jsondata, codeHttp) {
                                    if (typeof jsondata.error_message != "undefined") {
                                        alert(jsondata.error_message);
                                    } else {

                                        if (codeHttp === 'success') {
                                            var jstree = $('#jstree');

                                            jstree.jstree({
                                                'core': {
                                                    'check_callback': true
                                                },
                                                "checkbox": {
                                                    "keep_selected_style": false
                                                },
                                                "search": {
                                                    "case_insensitive": true,
                                                    "show_only_matches": true
                                                },
                                                "plugins": ["checkbox", "search"]
                                            });
                                            jstree.jstree(true).settings.core.data = jsondata;
                                            jstree.jstree(true).refresh();
                                        }
                                    }
                                }
                            });
                        }
                    });
                }

                function submitScan() {
                    var jstree = $('#jstree');
                    var machineid = jstree.jstree(true)._model.data['#'].original.machineid;
                    console.log(machineid);
                    var checked = jstree.jstree(true).get_selected();
                    var a = [];
                    for (var i = 0; i < checked.length; i++) {
                        var o = {};
                        o = checked[i];
                        a[i] = o;
                    }
                    var body = {};
                    body.folders_toscan = a;
                    body.machineid = machineid;
                    var jsondata = JSON.stringify(body);
                    // console.log(jsondata);
                    $.ajax({
                        dataType: "json",
                        url: "scan",
                        type: 'POST',
                        data: jsondata,
                        success: function (responsedata, codeHttp) {
                            if (codeHttp === "success") {
                                alert(responsedata);
                            }
                        }
                    });
                    console.log(checked);
                }
            </script>

        </div>
    </div>
</div>

</body>
</html>
